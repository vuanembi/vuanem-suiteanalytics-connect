from netsuite.pipeline.interface import Pipeline, Key
from netsuite.repo import netsuite2_connection
from db.bigquery import timeframe_builder, update

pipeline = Pipeline(
    "ns2_transaction2",
    [
        {"name": "abbrevtype", "type": "STRING"},
        {"name": "accountbasednumber", "type": "STRING"},
        {"name": "actionitem", "type": "STRING"},
        {"name": "actualshipdate", "type": "TIMESTAMP"},
        {"name": "altsalestotal", "type": "FLOAT"},
        {"name": "approvalstatus", "type": "INTEGER"},
        {"name": "balsegstatus", "type": "INTEGER"},
        {"name": "billingaddress", "type": "INTEGER"},
        {"name": "billingstatus", "type": "STRING"},
        {"name": "bulkprocsubmission", "type": "INTEGER"},
        {"name": "buyingreason", "type": "INTEGER"},
        {"name": "buyingtimeframe", "type": "INTEGER"},
        {"name": "closedate", "type": "TIMESTAMP"},
        {"name": "createdby", "type": "INTEGER"},
        {"name": "createddate", "type": "TIMESTAMP"},
        {"name": "currency", "type": "INTEGER"},
        {"name": "custbody1", "type": "STRING"},
        {"name": "custbody11", "type": "INTEGER"},
        {"name": "custbody12", "type": "INTEGER"},
        {"name": "custbody13", "type": "STRING"},
        {"name": "custbody14", "type": "STRING"},
        {"name": "custbody15", "type": "STRING"},
        {"name": "custbody16", "type": "STRING"},
        {"name": "custbody17", "type": "INTEGER"},
        {"name": "custbody6", "type": "INTEGER"},
        {"name": "custbody7", "type": "STRING"},
        {"name": "custbody_4110_customregnum", "type": "STRING"},
        {"name": "custbody_4599_mx_operation_type", "type": "INTEGER"},
        {"name": "custbody_4599_sg_import_permit_num", "type": "STRING"},
        {"name": "custbody_actual_delivery_date", "type": "TIMESTAMP"},
        {"name": "custbody_actual_location", "type": "INTEGER"},
        {"name": "custbody_adjustment_journal", "type": "STRING"},
        {"name": "custbody_approve_person", "type": "STRING"},
        {"name": "custbody_approved", "type": "STRING"},
        {"name": "custbody_approved_date", "type": "TIMESTAMP"},
        {"name": "custbody_cash_flow_code", "type": "STRING"},
        {"name": "custbody_cash_register", "type": "STRING"},
        {"name": "custbody_check_mass_update", "type": "STRING"},
        {"name": "custbody_chk_submit_customgl", "type": "STRING"},
        {"name": "custbody_citek_bien_ban_dchd", "type": "INTEGER"},
        {"name": "custbody_citek_check_loyalty", "type": "STRING"},
        {"name": "custbody_closedreason", "type": "INTEGER"},
        {"name": "custbody_counterparty_vat", "type": "STRING"},
        {"name": "custbody_country_of_origin", "type": "STRING"},
        {"name": "custbody_created_by", "type": "INTEGER"},
        {"name": "custbody_cseg_new_segment", "type": "INTEGER"},
        {"name": "custbody_current_partner", "type": "STRING"},
        {"name": "custbody_customer_phone", "type": "STRING"},
        {"name": "custbody_date_lsa", "type": "TIMESTAMP"},
        {"name": "custbody_date_of_taxable_supply", "type": "TIMESTAMP"},
        {"name": "custbody_delivery_instructions", "type": "STRING"},
        {"name": "custbody_delivery_person", "type": "INTEGER"},
        {"name": "custbody_delivery_status", "type": "INTEGER"},
        {"name": "custbody_delivery_terms", "type": "INTEGER"},
        {"name": "custbody_delivery_vehicle", "type": "INTEGER"},
        {"name": "custbody_deposit_payment_method", "type": "INTEGER"},
        {"name": "custbody_distance", "type": "STRING"},
        {"name": "custbody_document_version", "type": "STRING"},
        {"name": "custbody_e_invoice_status", "type": "STRING"},
        {"name": "custbody_e_invoice_status_pxk", "type": "STRING"},
        {"name": "custbody_e_invoice_tbss_status", "type": "STRING"},
        {"name": "custbody_eddchanged", "type": "STRING"},
        {"name": "custbody_einvoice_no", "type": "STRING"},
        {"name": "custbody_einvoice_no_mau01", "type": "STRING"},
        {"name": "custbody_event", "type": "INTEGER"},
        {"name": "custbody_expected_delivery_date_c", "type": "TIMESTAMP"},
        {"name": "custbody_expected_shipping_method", "type": "INTEGER"},
        {"name": "custbody_expecteddeliverytime", "type": "INTEGER"},
        {"name": "custbody_fam_jrn_is_reversal", "type": "STRING"},
        {"name": "custbody_fam_jrn_reversal_date", "type": "TIMESTAMP"},
        {"name": "custbody_fam_jrn_reversal_no", "type": "INTEGER"},
        {"name": "custbody_fam_lp_asset", "type": "INTEGER"},
        {"name": "custbody_fam_lp_assetdesc", "type": "STRING"},
        {"name": "custbody_fam_lp_assetprop", "type": "INTEGER"},
        {"name": "custbody_fam_lp_company", "type": "INTEGER"},
        {"name": "custbody_fam_lp_contract", "type": "INTEGER"},
        {"name": "custbody_fam_lp_contractnum", "type": "STRING"},
        {"name": "custbody_fam_lp_financelease", "type": "STRING"},
        {"name": "custbody_fam_lp_gainonmod", "type": "INTEGER"},
        {"name": "custbody_fam_lp_intexpense", "type": "INTEGER"},
        {"name": "custbody_fam_lp_leaseliability", "type": "INTEGER"},
        {"name": "custbody_fam_lp_rightofuse", "type": "INTEGER"},
        {"name": "custbody_fam_lp_startdate", "type": "TIMESTAMP"},
        {"name": "custbody_fam_lp_totalinterest", "type": "FLOAT"},
        {"name": "custbody_fam_lp_totalleaseliab", "type": "FLOAT"},
        {"name": "custbody_fam_lp_totalleasepayment", "type": "FLOAT"},
        {"name": "custbody_fam_lp_totalnpv", "type": "FLOAT"},
        {"name": "custbody_fam_lp_totalprincipal", "type": "FLOAT"},
        {"name": "custbody_fam_specdeprjrn_shortage", "type": "FLOAT"},
        {"name": "custbody_fam_specdeprjrn_specialdepr", "type": "INTEGER"},
        {"name": "custbody_gl_update_timestamp", "type": "TIMESTAMP"},
        {"name": "custbody_import_shipment_ref", "type": "INTEGER"},
        {"name": "custbody_in_charge_location", "type": "INTEGER"},
        {"name": "custbody_int_sync_to_vninvoice", "type": "STRING"},
        {"name": "custbody_int_sync_to_vninvoice03", "type": "STRING"},
        {"name": "custbody_invoice_date", "type": "TIMESTAMP"},
        {"name": "custbody_itr_doc_number", "type": "STRING"},
        {"name": "custbody_itr_nexus", "type": "STRING"},
        {"name": "custbody_journal_type", "type": "INTEGER"},
        {"name": "custbody_journal_type2", "type": "INTEGER"},
        {"name": "custbody_license_plate", "type": "STRING"},
        {"name": "custbody_license_plates", "type": "INTEGER"},
        {"name": "custbody_link_lsa", "type": "STRING"},
        {"name": "custbody_link_name_lsa", "type": "STRING"},
        {"name": "custbody_mage_order_id", "type": "STRING"},
        {"name": "custbody_mage_order_number", "type": "STRING"},
        {"name": "custbody_mage_order_total", "type": "FLOAT"},
        {"name": "custbody_mode_of_transport", "type": "INTEGER"},
        {"name": "custbody_my_import_declaration_num", "type": "STRING"},
        {"name": "custbody_nexus_notc", "type": "INTEGER"},
        {"name": "custbody_no_of_attempts", "type": "INTEGER"},
        {"name": "custbody_nondeductible_processed", "type": "STRING"},
        {"name": "custbody_nondeductible_ref_genjrnl", "type": "INTEGER"},
        {"name": "custbody_nondeductible_ref_tran", "type": "STRING"},
        {"name": "custbody_notc", "type": "INTEGER"},
        {"name": "custbody_onl_rep", "type": "INTEGER"},
        {"name": "custbody_order_payment_method", "type": "INTEGER"},
        {"name": "custbody_payment_hold_reason", "type": "STRING"},
        {"name": "custbody_payment_trancode", "type": "STRING"},
        {"name": "custbody_pendingupdate", "type": "STRING"},
        {"name": "custbody_pendingupdate01", "type": "STRING"},
        {"name": "custbody_po_approval_status", "type": "INTEGER"},
        {"name": "custbody_print_form", "type": "STRING"},
        {"name": "custbody_purchase_type", "type": "INTEGER"},
        {"name": "custbody_recipient", "type": "STRING"},
        {"name": "custbody_recipient_phone", "type": "STRING"},
        {"name": "custbody_ref_doc_no", "type": "STRING"},
        {"name": "custbody_ref_invoice", "type": "INTEGER"},
        {"name": "custbody_ref_multiple_transaction", "type": "STRING"},
        {"name": "custbody_ref_transaction", "type": "INTEGER"},
        {"name": "custbody_reference_sales_order", "type": "INTEGER"},
        {"name": "custbody_refno_originvoice", "type": "STRING"},
        {"name": "custbody_refund_payment_method", "type": "INTEGER"},
        {"name": "custbody_regime_code", "type": "INTEGER"},
        {"name": "custbody_regime_code_of_supply", "type": "INTEGER"},
        {"name": "custbody_rejected", "type": "STRING"},
        {"name": "custbody_rejected_date", "type": "TIMESTAMP"},
        {"name": "custbody_report_timestamp", "type": "STRING"},
        {"name": "custbody_revision", "type": "INTEGER"},
        {"name": "custbody_scv_external_transaction", "type": "STRING"},
        {"name": "custbody_sign_status", "type": "STRING"},
        {"name": "custbody_sign_status_03", "type": "STRING"},
        {"name": "custbody_so_billinginfor_address", "type": "STRING"},
        {"name": "custbody_so_billinginfor_name", "type": "STRING"},
        {"name": "custbody_so_billinginfor_taxno", "type": "STRING"},
        {"name": "custbody_submit_to_app", "type": "STRING"},
        {"name": "custbody_subsidiary_main", "type": "INTEGER"},
        {"name": "custbody_supportperson", "type": "STRING"},
        {"name": "custbody_tbt_loyalty_sale_loy_cgrp_lvl", "type": "INTEGER"},
        {"name": "custbody_tbt_loyalty_sale_loy_cust_grp", "type": "INTEGER"},
        {"name": "custbody_tbt_loyalty_sale_loy_eli", "type": "STRING"},
        {"name": "custbody_tbt_loyalty_sale_loy_loc_grp", "type": "INTEGER"},
        {"name": "custbody_tei_check_printed", "type": "STRING"},
        {"name": "custbody_tei_editing_counting", "type": "INTEGER"},
        {"name": "custbody_tei_fam_vendor", "type": "STRING"},
        {"name": "custbody_tei_invoice_serial_no", "type": "STRING"},
        {"name": "custbody_tei_loyalty_expired_date", "type": "TIMESTAMP"},
        {"name": "custbody_tei_loyalty_remain_point", "type": "FLOAT"},
        {"name": "custbody_tei_template_no", "type": "STRING"},
        {"name": "custbody_to_type", "type": "INTEGER"},
        {"name": "custbody_transaction_code", "type": "STRING"},
        {"name": "custbody_transaction_region", "type": "INTEGER"},
        {"name": "custbody_tvn_vnpay_message", "type": "STRING"},
        {"name": "custbody_tvn_vnpay_pos_id", "type": "INTEGER"},
        {"name": "custbody_tvn_vnpay_status", "type": "INTEGER"},
        {"name": "custbody_vendor_invoice_prefix", "type": "STRING"},
        {"name": "custbody_vnbi_voucher_adjustment", "type": "INTEGER"},
        {"name": "custbody_vnpay_tran_code", "type": "STRING"},
        {"name": "custbody_vra_type", "type": "INTEGER"},
        {"name": "custbody_wms_delivert_routing_status", "type": "INTEGER"},
        {"name": "custbody_wms_delivery_rouitg_remarks", "type": "STRING"},
        {"name": "custbody_wms_delivery_routing_driver", "type": "INTEGER"},
        {"name": "custbody_wms_delivery_shipping_person", "type": "INTEGER"},
        {"name": "custbody_wms_delivery_time_stamp", "type": "STRING"},
        {"name": "custbody_wms_track_no", "type": "STRING"},
        {"name": "custbodycskh_da_goi_rating", "type": "INTEGER"},
        {"name": "custbodycustbody_closedreason2", "type": "INTEGER"},
        {"name": "custbodycustbodycskh_da_goi_vesinhdem", "type": "INTEGER"},
        {"name": "custbodycustome_return_reason2", "type": "INTEGER"},
        {"name": "custbodyexpected_shipdate_to", "type": "TIMESTAMP"},
        {"name": "custbodykho_da_goi", "type": "STRING"},
        {"name": "custbodypo_delivery_status", "type": "INTEGER"},
        {"name": "custbodyservice_add_on", "type": "STRING"},
        {"name": "custbodyservice_add_on_to", "type": "STRING"},
        {"name": "custbodysotienthuengoai", "type": "FLOAT"},
        {"name": "custbodythoi_gian_xuat_kho_gio", "type": "INTEGER"},
        {"name": "custbodythoi_gian_xuat_kho_phut", "type": "INTEGER"},
        {"name": "custbodyvanchuyen_note", "type": "STRING"},
        {"name": "custbodywarehouse_person", "type": "STRING"},
        {"name": "daysopen", "type": "INTEGER"},
        {"name": "daysoverduesearch", "type": "INTEGER"},
        {"name": "duedate", "type": "TIMESTAMP"},
        {"name": "email", "type": "STRING"},
        {"name": "employee", "type": "INTEGER"},
        {"name": "enddate", "type": "TIMESTAMP"},
        {"name": "entity", "type": "INTEGER"},
        {"name": "entitystatus", "type": "INTEGER"},
        {"name": "estgrossprofit", "type": "FLOAT"},
        {"name": "estgrossprofitpercent", "type": "FLOAT"},
        {"name": "estimatedbudget", "type": "FLOAT"},
        {"name": "exchangerate", "type": "FLOAT"},
        {"name": "expectedclosedate", "type": "TIMESTAMP"},
        {"name": "externalid", "type": "STRING"},
        {"name": "fax", "type": "STRING"},
        {"name": "firmed", "type": "STRING"},
        {"name": "forecasttype", "type": "INTEGER"},
        {"name": "foreignamountpaid", "type": "FLOAT"},
        {"name": "foreignamountunpaid", "type": "FLOAT"},
        {"name": "foreignpaymentamountunused", "type": "FLOAT"},
        {"name": "foreignpaymentamountused", "type": "FLOAT"},
        {"name": "foreigntotal", "type": "FLOAT"},
        {"name": "fulfillmenttype", "type": "INTEGER"},
        {"name": "id", "type": "INTEGER"},
        {"name": "incoterm", "type": "INTEGER"},
        {"name": "intercostatus", "type": "INTEGER"},
        {"name": "intercotransaction", "type": "INTEGER"},
        {"name": "isbudgetapproved", "type": "STRING"},
        {"name": "isfinchrg", "type": "STRING"},
        {"name": "isreversal", "type": "STRING"},
        {"name": "journaltype", "type": "STRING"},
        {"name": "lastmodifiedby", "type": "INTEGER"},
        {"name": "lastmodifieddate", "type": "TIMESTAMP"},
        {"name": "leadsource", "type": "INTEGER"},
        {"name": "linkedtrackingnumberlist", "type": "STRING"},
        {"name": "memdoc", "type": "INTEGER"},
        {"name": "memo", "type": "STRING"},
        {"name": "message", "type": "STRING"},
        {"name": "netaltsalestotal", "type": "FLOAT"},
        {"name": "nextapprover", "type": "INTEGER"},
        {"name": "nextbilldate", "type": "TIMESTAMP"},
        {"name": "nexus", "type": "INTEGER"},
        {"name": "number", "type": "INTEGER"},
        {"name": "opportunity", "type": "INTEGER"},
        {"name": "ordpicked", "type": "STRING"},
        {"name": "ordreceived", "type": "STRING"},
        {"name": "otherrefnum", "type": "STRING"},
        {"name": "partner", "type": "INTEGER"},
        {"name": "paymenthold", "type": "STRING"},
        {"name": "paymentmethod", "type": "INTEGER"},
        {"name": "paymentoption", "type": "INTEGER"},
        {"name": "posting", "type": "STRING"},
        {"name": "postingperiod", "type": "INTEGER"},
        {"name": "printedpickingticket", "type": "STRING"},
        {"name": "probability", "type": "FLOAT"},
        {"name": "projectedtotal", "type": "FLOAT"},
        {"name": "promotioncombinations", "type": "STRING"},
        {"name": "rangehigh", "type": "FLOAT"},
        {"name": "rangelow", "type": "FLOAT"},
        {"name": "recordtype", "type": "STRING"},
        {"name": "reversal", "type": "INTEGER"},
        {"name": "reversaldate", "type": "TIMESTAMP"},
        {"name": "revision", "type": "INTEGER"},
        {"name": "salesreadiness", "type": "INTEGER"},
        {"name": "shipcarrier", "type": "STRING"},
        {"name": "shipcomplete", "type": "STRING"},
        {"name": "shipdate", "type": "TIMESTAMP"},
        {"name": "shippingaddress", "type": "INTEGER"},
        {"name": "source", "type": "STRING"},
        {"name": "sourcetransaction", "type": "INTEGER"},
        {"name": "startdate", "type": "TIMESTAMP"},
        {"name": "status", "type": "STRING"},
        {"name": "terms", "type": "INTEGER"},
        {"name": "title", "type": "STRING"},
        {"name": "tosubsidiary", "type": "INTEGER"},
        {"name": "totalcostestimate", "type": "FLOAT"},
        {"name": "trackingnumberlist", "type": "STRING"},
        {"name": "trandate", "type": "TIMESTAMP"},
        {"name": "trandisplayname", "type": "STRING"},
        {"name": "tranid", "type": "STRING"},
        {"name": "transactionnumber", "type": "STRING"},
        {"name": "transferlocation", "type": "INTEGER"},
        {"name": "type", "type": "STRING"},
        {"name": "typebaseddocumentnumber", "type": "STRING"},
        {"name": "useitemcostastransfercost", "type": "STRING"},
        {"name": "userevenuearrangement", "type": "STRING"},
        {"name": "visibletocustomer", "type": "STRING"},
        {"name": "void", "type": "STRING"},
        {"name": "voided", "type": "STRING"},
        {"name": "website", "type": "INTEGER"},
        {"name": "weightedtotal", "type": "FLOAT"},
        {"name": "winlossreason", "type": "INTEGER"},
    ],
    conn_fn=netsuite2_connection,
    query_fn=lambda tr: f"""
        SELECT
            id,
            lastmodifieddate,
            recordtype
        FROM
            transaction
        WHERE
            lastmodifieddate >= TO_DATE('{tr[0]}', 'YYYY-MM-DD HH24:MI:SS')
            AND lastmodifieddate <= TO_DATE('{tr[1]}', 'YYYY-MM-DD HH24:MI:SS')
    """,
    param_fn=timeframe_builder,
    key=Key(
        id_key=["id"],
        cursor_key=["lastmodifieddate"],
    ),
    load_callback_fn=update,
)
